{"version":3,"file":"convertInputToNodeStream.js","names":["fs","Blob","Stream","Readable","convertInputToNodeStream","input","Buffer","createReadableStreamFromBuffer","createReadableStreamFromBlob","createReadStream","buffer","length","Error","from","blob","size","fromWeb","stream"],"sources":["../../source/export/convertInputToNodeStream.js"],"sourcesContent":["import fs from 'fs'\r\nimport { Blob } from 'buffer'\r\nimport Stream, { Readable } from 'stream'\r\n\r\n/**\r\n * Converts Node.js input argument to a stream.\r\n * @param  {(string|Stream|Buffer|Blob)} input - A Node.js readable stream or a `Buffer` or a `Blob` or a path to a file.\r\n * @returns {Stream}\r\n */\r\nexport default function convertInputToNodeStream(input) {\r\n  return input instanceof Stream\r\n    ? input\r\n    : (\r\n      input instanceof Buffer\r\n        ? createReadableStreamFromBuffer(input)\r\n        : (\r\n          input instanceof Blob\r\n            ? createReadableStreamFromBlob(input)\r\n            : fs.createReadStream(input)\r\n        )\r\n    )\r\n}\r\n\r\n// Creates a readable stream from a `Buffer`.\r\nfunction createReadableStreamFromBuffer(buffer) {\r\n  // Node.js seems to have a bug in `Readable.from()` function:\r\n  // it doesn't correctly handle empty buffers, i.e. it doesn't return a correct stream.\r\n  // https://gitlab.com/catamphetamine/read-excel-file/-/issues/106\r\n  if (buffer.length === 0) {\r\n    throw new Error('No data')\r\n  }\r\n  return Readable.from(buffer)\r\n}\r\n\r\n// Creates a readable stream from a `Blob`.\r\nfunction createReadableStreamFromBlob(blob) {\r\n  // I didn't test but I'd presume that Node.js would throw on an empty `Blob`\r\n  // same way it does on an empty `Buffer`.\r\n  // https://gitlab.com/catamphetamine/read-excel-file/-/issues/106\r\n  if (blob.size === 0) {\r\n    throw new Error('No data')\r\n  }\r\n  // Convert a web `ReadableStream` to a Node.js `Readable` `Stream`.\r\n  return Readable.fromWeb(blob.stream())\r\n}"],"mappings":"AAAA,OAAOA,EAAE,MAAM,IAAI;AACnB,SAASC,IAAI,QAAQ,QAAQ;AAC7B,OAAOC,MAAM,IAAIC,QAAQ,QAAQ,QAAQ;;AAEzC;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,wBAAwBA,CAACC,KAAK,EAAE;EACtD,OAAOA,KAAK,YAAYH,MAAM,GAC1BG,KAAK,GAELA,KAAK,YAAYC,MAAM,GACnBC,8BAA8B,CAACF,KAAK,CAAC,GAErCA,KAAK,YAAYJ,IAAI,GACjBO,4BAA4B,CAACH,KAAK,CAAC,GACnCL,EAAE,CAACS,gBAAgB,CAACJ,KAAK,CAElC;AACL;;AAEA;AACA,SAASE,8BAA8BA,CAACG,MAAM,EAAE;EAC9C;EACA;EACA;EACA,IAAIA,MAAM,CAACC,MAAM,KAAK,CAAC,EAAE;IACvB,MAAM,IAAIC,KAAK,CAAC,SAAS,CAAC;EAC5B;EACA,OAAOT,QAAQ,CAACU,IAAI,CAACH,MAAM,CAAC;AAC9B;;AAEA;AACA,SAASF,4BAA4BA,CAACM,IAAI,EAAE;EAC1C;EACA;EACA;EACA,IAAIA,IAAI,CAACC,IAAI,KAAK,CAAC,EAAE;IACnB,MAAM,IAAIH,KAAK,CAAC,SAAS,CAAC;EAC5B;EACA;EACA,OAAOT,QAAQ,CAACa,OAAO,CAACF,IAAI,CAACG,MAAM,CAAC,CAAC,CAAC;AACxC"}